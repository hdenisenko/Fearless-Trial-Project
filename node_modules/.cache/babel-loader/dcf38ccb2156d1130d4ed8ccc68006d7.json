{"ast":null,"code":"const crossfetch = require('cross-fetch');\n\nconst BASE_API_PATH = \"https://api.countapi.xyz\";\nconst validPattern = /^[A-Za-z0-9_\\-.]{3,64}$/;\nconst validRegex = new RegExp(validPattern);\n\nconst validatePath = module.exports.validatePath = function (namespace, key) {\n  if (typeof key === \"undefined\") {\n    if (typeof namespace === \"undefined\") {\n      return Promise.reject(\"Missing key\");\n    }\n\n    key = namespace;\n    namespace = undefined;\n  }\n\n  function validName(name) {\n    return validRegex.test(name) || name === ':HOST:' || name === ':PATHNAME:';\n  }\n\n  return new Promise(function (resolve, reject) {\n    if (!validName(key)) {\n      reject(`Key must match ${validPattern}. Got '${namespace}'`);\n      return;\n    }\n\n    if (!validName(namespace) && typeof namespace !== \"undefined\" && namespace !== null) {\n      reject(`Namespace must match ${validPattern} or be empty. Got '${namespace}'`);\n      return;\n    }\n\n    var path = '';\n    if (typeof namespace !== \"undefined\") path += namespace + '/';\n    path += key;\n    resolve({\n      path: path\n    });\n  });\n};\n\nconst validateTuple = module.exports.validateTuple = function (namespace, key, value) {\n  if (typeof value === \"undefined\") {\n    if (typeof key === \"undefined\") {\n      return Promise.reject(\"Missing key or value\");\n    }\n\n    value = key;\n    key = undefined;\n  }\n\n  if (typeof value !== \"number\") {\n    return Promise.reject(\"Value is NaN\");\n  }\n\n  return validatePath(namespace, key).then(function (result) {\n    return Object.assign({}, {\n      value: value\n    }, result);\n  });\n};\n\nfunction finalize(res) {\n  const valid_responses = [200, 400, 403, 404];\n\n  if (valid_responses.includes(res.status)) {\n    return res.json().then(function (json) {\n      if (res.status == 400) return Promise.reject(json.error);\n      return Object.assign({}, {\n        status: res.status,\n        path: res.headers.get('X-Path')\n      }, json);\n    });\n  }\n\n  return Promise.reject(\"Response from server: \" + res.status);\n}\n\nfunction queryParams(params) {\n  return Object.keys(params || {}).map(k => encodeURIComponent(k) + '=' + encodeURIComponent(params[k])).join('&');\n}\n\nmodule.exports.get = function (namespace, key) {\n  return validatePath(namespace, key).then(function (result) {\n    return crossfetch(`${BASE_API_PATH}/get/${result.path}`).then(finalize);\n  });\n};\n\nmodule.exports.set = function (namespace, key, value) {\n  return validateTuple(namespace, key, value).then(function (result) {\n    return crossfetch(`${BASE_API_PATH}/set/${result.path}?value=${result.value}`).then(finalize);\n  });\n};\n\nmodule.exports.update = function (namespace, key, amount) {\n  return validateTuple(namespace, key, amount).then(function (result) {\n    return crossfetch(`${BASE_API_PATH}/update/${result.path}?amount=${result.value}`).then(finalize);\n  });\n};\n\nmodule.exports.hit = function (namespace, key) {\n  return validatePath(namespace, key).then(function (result) {\n    return crossfetch(`${BASE_API_PATH}/hit/${result.path}`).then(finalize);\n  });\n};\n\nmodule.exports.info = function (namespace, key) {\n  return validatePath(namespace, key).then(function (result) {\n    return crossfetch(`${BASE_API_PATH}/info/${result.path}`).then(finalize);\n  });\n};\n\nmodule.exports.create = function (options) {\n  var params = queryParams(options);\n  return crossfetch(`${BASE_API_PATH}/create${params.length > 0 ? '?' + params : ''}`).then(finalize);\n};\n\nmodule.exports.stats = function () {\n  return crossfetch(`${BASE_API_PATH}/stats`).then(finalize);\n};\n\nmodule.exports.visits = function (page) {\n  return this.hit(':HOST:', page ? page : ':PATHNAME:');\n};\n\nmodule.exports.event = function (name) {\n  return this.hit(':HOST:', name);\n};","map":{"version":3,"sources":["/Users/arun/my-app/node_modules/countapi-js/lib/index.js"],"names":["crossfetch","require","BASE_API_PATH","validPattern","validRegex","RegExp","validatePath","module","exports","namespace","key","Promise","reject","undefined","validName","name","test","resolve","path","validateTuple","value","then","result","Object","assign","finalize","res","valid_responses","includes","status","json","error","headers","get","queryParams","params","keys","map","k","encodeURIComponent","join","set","update","amount","hit","info","create","options","length","stats","visits","page","event"],"mappings":"AAAA,MAAMA,UAAU,GAAGC,OAAO,CAAC,aAAD,CAA1B;;AAEA,MAAMC,aAAa,GAAG,0BAAtB;AACA,MAAMC,YAAY,GAAG,yBAArB;AACA,MAAMC,UAAU,GAAG,IAAIC,MAAJ,CAAWF,YAAX,CAAnB;;AAEA,MAAMG,YAAY,GAAGC,MAAM,CAACC,OAAP,CAAeF,YAAf,GAA8B,UAASG,SAAT,EAAoBC,GAApB,EAAyB;AACxE,MAAG,OAAOA,GAAP,KAAe,WAAlB,EAA+B;AAC3B,QAAG,OAAOD,SAAP,KAAqB,WAAxB,EAAqC;AACjC,aAAOE,OAAO,CAACC,MAAR,CAAe,aAAf,CAAP;AACH;;AACDF,IAAAA,GAAG,GAAGD,SAAN;AACAA,IAAAA,SAAS,GAAGI,SAAZ;AACH;;AAED,WAASC,SAAT,CAAmBC,IAAnB,EAAyB;AACrB,WAAOX,UAAU,CAACY,IAAX,CAAgBD,IAAhB,KAAyBA,IAAI,KAAK,QAAlC,IAA8CA,IAAI,KAAK,YAA9D;AACH;;AAED,SAAO,IAAIJ,OAAJ,CAAY,UAASM,OAAT,EAAkBL,MAAlB,EAA0B;AACzC,QAAG,CAACE,SAAS,CAACJ,GAAD,CAAb,EAAoB;AAChBE,MAAAA,MAAM,CAAE,kBAAiBT,YAAa,UAASM,SAAU,GAAnD,CAAN;AACA;AACH;;AACD,QAAG,CAACK,SAAS,CAACL,SAAD,CAAV,IAAyB,OAAOA,SAAP,KAAqB,WAA9C,IAA6DA,SAAS,KAAK,IAA9E,EAAoF;AAChFG,MAAAA,MAAM,CAAE,wBAAuBT,YAAa,sBAAqBM,SAAU,GAArE,CAAN;AACA;AACH;;AAED,QAAIS,IAAI,GAAG,EAAX;AACA,QAAG,OAAOT,SAAP,KAAqB,WAAxB,EACIS,IAAI,IAAIT,SAAS,GAAG,GAApB;AACJS,IAAAA,IAAI,IAAIR,GAAR;AAEAO,IAAAA,OAAO,CAAC;AACJC,MAAAA,IAAI,EAAEA;AADF,KAAD,CAAP;AAGH,GAlBM,CAAP;AAmBH,CAhCD;;AAkCA,MAAMC,aAAa,GAAGZ,MAAM,CAACC,OAAP,CAAeW,aAAf,GAA+B,UAASV,SAAT,EAAoBC,GAApB,EAAyBU,KAAzB,EAAgC;AACjF,MAAG,OAAOA,KAAP,KAAiB,WAApB,EAAiC;AAC7B,QAAG,OAAOV,GAAP,KAAe,WAAlB,EAA+B;AAC3B,aAAOC,OAAO,CAACC,MAAR,CAAe,sBAAf,CAAP;AACH;;AACDQ,IAAAA,KAAK,GAAGV,GAAR;AACAA,IAAAA,GAAG,GAAGG,SAAN;AACH;;AACD,MAAG,OAAOO,KAAP,KAAiB,QAApB,EAA8B;AAC1B,WAAOT,OAAO,CAACC,MAAR,CAAe,cAAf,CAAP;AACH;;AAED,SAAON,YAAY,CAACG,SAAD,EAAYC,GAAZ,CAAZ,CAA6BW,IAA7B,CAAkC,UAASC,MAAT,EAAiB;AACtD,WAAOC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkB;AAAEJ,MAAAA,KAAK,EAAEA;AAAT,KAAlB,EAAoCE,MAApC,CAAP;AACH,GAFM,CAAP;AAGH,CAfD;;AAiBA,SAASG,QAAT,CAAkBC,GAAlB,EAAuB;AACnB,QAAMC,eAAe,GAAG,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgB,GAAhB,CAAxB;;AACA,MAAIA,eAAe,CAACC,QAAhB,CAAyBF,GAAG,CAACG,MAA7B,CAAJ,EAA0C;AACtC,WAAOH,GAAG,CAACI,IAAJ,GAAWT,IAAX,CAAgB,UAASS,IAAT,EAAe;AAClC,UAAGJ,GAAG,CAACG,MAAJ,IAAc,GAAjB,EACI,OAAOlB,OAAO,CAACC,MAAR,CAAekB,IAAI,CAACC,KAApB,CAAP;AACJ,aAAOR,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkB;AACrBK,QAAAA,MAAM,EAAEH,GAAG,CAACG,MADS;AAErBX,QAAAA,IAAI,EAAEQ,GAAG,CAACM,OAAJ,CAAYC,GAAZ,CAAgB,QAAhB;AAFe,OAAlB,EAGJH,IAHI,CAAP;AAIH,KAPM,CAAP;AAQH;;AACD,SAAOnB,OAAO,CAACC,MAAR,CAAe,2BAA2Bc,GAAG,CAACG,MAA9C,CAAP;AACH;;AAED,SAASK,WAAT,CAAqBC,MAArB,EAA6B;AACzB,SAAOZ,MAAM,CAACa,IAAP,CAAYD,MAAM,IAAI,EAAtB,EACFE,GADE,CACEC,CAAC,IAAIC,kBAAkB,CAACD,CAAD,CAAlB,GAAwB,GAAxB,GAA8BC,kBAAkB,CAACJ,MAAM,CAACG,CAAD,CAAP,CADvD,EAEFE,IAFE,CAEG,GAFH,CAAP;AAGH;;AAEDjC,MAAM,CAACC,OAAP,CAAeyB,GAAf,GAAqB,UAASxB,SAAT,EAAoBC,GAApB,EAAyB;AAC1C,SAAOJ,YAAY,CAACG,SAAD,EAAYC,GAAZ,CAAZ,CAA6BW,IAA7B,CAAkC,UAASC,MAAT,EAAiB;AACtD,WAAOtB,UAAU,CAAE,GAAEE,aAAc,QAAOoB,MAAM,CAACJ,IAAK,EAArC,CAAV,CAAkDG,IAAlD,CAAuDI,QAAvD,CAAP;AACH,GAFM,CAAP;AAGH,CAJD;;AAMAlB,MAAM,CAACC,OAAP,CAAeiC,GAAf,GAAqB,UAAShC,SAAT,EAAoBC,GAApB,EAAyBU,KAAzB,EAAgC;AACjD,SAAOD,aAAa,CAACV,SAAD,EAAYC,GAAZ,EAAiBU,KAAjB,CAAb,CAAqCC,IAArC,CAA0C,UAASC,MAAT,EAAiB;AAC9D,WAAOtB,UAAU,CAAE,GAAEE,aAAc,QAAOoB,MAAM,CAACJ,IAAK,UAASI,MAAM,CAACF,KAAM,EAA3D,CAAV,CAAwEC,IAAxE,CAA6EI,QAA7E,CAAP;AACH,GAFM,CAAP;AAGH,CAJD;;AAMAlB,MAAM,CAACC,OAAP,CAAekC,MAAf,GAAwB,UAASjC,SAAT,EAAoBC,GAApB,EAAyBiC,MAAzB,EAAiC;AACrD,SAAOxB,aAAa,CAACV,SAAD,EAAYC,GAAZ,EAAiBiC,MAAjB,CAAb,CAAsCtB,IAAtC,CAA2C,UAASC,MAAT,EAAiB;AAC/D,WAAOtB,UAAU,CAAE,GAAEE,aAAc,WAAUoB,MAAM,CAACJ,IAAK,WAAUI,MAAM,CAACF,KAAM,EAA/D,CAAV,CAA4EC,IAA5E,CAAiFI,QAAjF,CAAP;AACH,GAFM,CAAP;AAGH,CAJD;;AAMAlB,MAAM,CAACC,OAAP,CAAeoC,GAAf,GAAqB,UAASnC,SAAT,EAAoBC,GAApB,EAAyB;AAC1C,SAAOJ,YAAY,CAACG,SAAD,EAAYC,GAAZ,CAAZ,CAA6BW,IAA7B,CAAkC,UAASC,MAAT,EAAiB;AACtD,WAAOtB,UAAU,CAAE,GAAEE,aAAc,QAAOoB,MAAM,CAACJ,IAAK,EAArC,CAAV,CAAkDG,IAAlD,CAAuDI,QAAvD,CAAP;AACH,GAFM,CAAP;AAGH,CAJD;;AAMAlB,MAAM,CAACC,OAAP,CAAeqC,IAAf,GAAsB,UAASpC,SAAT,EAAoBC,GAApB,EAAyB;AAC3C,SAAOJ,YAAY,CAACG,SAAD,EAAYC,GAAZ,CAAZ,CAA6BW,IAA7B,CAAkC,UAASC,MAAT,EAAiB;AACtD,WAAOtB,UAAU,CAAE,GAAEE,aAAc,SAAQoB,MAAM,CAACJ,IAAK,EAAtC,CAAV,CAAmDG,IAAnD,CAAwDI,QAAxD,CAAP;AACH,GAFM,CAAP;AAGH,CAJD;;AAMAlB,MAAM,CAACC,OAAP,CAAesC,MAAf,GAAwB,UAASC,OAAT,EAAkB;AACtC,MAAIZ,MAAM,GAAGD,WAAW,CAACa,OAAD,CAAxB;AACA,SAAO/C,UAAU,CAAE,GAAEE,aAAc,UAASiC,MAAM,CAACa,MAAP,GAAgB,CAAhB,GAAoB,MAAMb,MAA1B,GAAmC,EAAG,EAAjE,CAAV,CAA8Ed,IAA9E,CAAmFI,QAAnF,CAAP;AACH,CAHD;;AAKAlB,MAAM,CAACC,OAAP,CAAeyC,KAAf,GAAuB,YAAW;AAC9B,SAAOjD,UAAU,CAAE,GAAEE,aAAc,QAAlB,CAAV,CAAqCmB,IAArC,CAA0CI,QAA1C,CAAP;AACH,CAFD;;AAIAlB,MAAM,CAACC,OAAP,CAAe0C,MAAf,GAAwB,UAASC,IAAT,EAAe;AACnC,SAAO,KAAKP,GAAL,CAAS,QAAT,EAAmBO,IAAI,GAAGA,IAAH,GAAU,YAAjC,CAAP;AACH,CAFD;;AAIA5C,MAAM,CAACC,OAAP,CAAe4C,KAAf,GAAuB,UAASrC,IAAT,EAAe;AAClC,SAAO,KAAK6B,GAAL,CAAS,QAAT,EAAmB7B,IAAnB,CAAP;AACH,CAFD","sourcesContent":["const crossfetch = require('cross-fetch');\r\n\r\nconst BASE_API_PATH = \"https://api.countapi.xyz\";\r\nconst validPattern = /^[A-Za-z0-9_\\-.]{3,64}$/;\r\nconst validRegex = new RegExp(validPattern);\r\n\r\nconst validatePath = module.exports.validatePath = function(namespace, key) {\r\n    if(typeof key === \"undefined\") {\r\n        if(typeof namespace === \"undefined\") {\r\n            return Promise.reject(\"Missing key\");\r\n        }\r\n        key = namespace;\r\n        namespace = undefined;\r\n    }\r\n\r\n    function validName(name) {\r\n        return validRegex.test(name) || name === ':HOST:' || name === ':PATHNAME:';\r\n    }\r\n\r\n    return new Promise(function(resolve, reject) {\r\n        if(!validName(key)) {\r\n            reject(`Key must match ${validPattern}. Got '${namespace}'`);\r\n            return;\r\n        }\r\n        if(!validName(namespace) && typeof namespace !== \"undefined\" && namespace !== null) {\r\n            reject(`Namespace must match ${validPattern} or be empty. Got '${namespace}'`);\r\n            return;\r\n        }\r\n        \r\n        var path = '';\r\n        if(typeof namespace !== \"undefined\")\r\n            path += namespace + '/';\r\n        path += key;\r\n        \r\n        resolve({\r\n            path: path\r\n        });\r\n    });\r\n}\r\n\r\nconst validateTuple = module.exports.validateTuple = function(namespace, key, value) {\r\n    if(typeof value === \"undefined\") {\r\n        if(typeof key === \"undefined\") {\r\n            return Promise.reject(\"Missing key or value\");\r\n        }\r\n        value = key;\r\n        key = undefined;\r\n    }\r\n    if(typeof value !== \"number\") {\r\n        return Promise.reject(\"Value is NaN\");\r\n    }\r\n\r\n    return validatePath(namespace, key).then(function(result) {\r\n        return Object.assign({}, { value: value }, result);\r\n    });\r\n}\r\n\r\nfunction finalize(res) {\r\n    const valid_responses = [200, 400, 403, 404];\r\n    if (valid_responses.includes(res.status)) {\r\n        return res.json().then(function(json) {\r\n            if(res.status == 400)\r\n                return Promise.reject(json.error);\r\n            return Object.assign({}, {\r\n                status: res.status,\r\n                path: res.headers.get('X-Path')\r\n            }, json);\r\n        });\r\n    }\r\n    return Promise.reject(\"Response from server: \" + res.status);\r\n}\r\n\r\nfunction queryParams(params) {\r\n    return Object.keys(params || {})\r\n        .map(k => encodeURIComponent(k) + '=' + encodeURIComponent(params[k]))\r\n        .join('&');\r\n}\r\n\r\nmodule.exports.get = function(namespace, key) {\r\n    return validatePath(namespace, key).then(function(result) {\r\n        return crossfetch(`${BASE_API_PATH}/get/${result.path}`).then(finalize);\r\n    });\r\n};\r\n\r\nmodule.exports.set = function(namespace, key, value) {\r\n    return validateTuple(namespace, key, value).then(function(result) {\r\n        return crossfetch(`${BASE_API_PATH}/set/${result.path}?value=${result.value}`).then(finalize);\r\n    });\r\n};\r\n\r\nmodule.exports.update = function(namespace, key, amount) {\r\n    return validateTuple(namespace, key, amount).then(function(result) {\r\n        return crossfetch(`${BASE_API_PATH}/update/${result.path}?amount=${result.value}`).then(finalize);\r\n    });\r\n};\r\n\r\nmodule.exports.hit = function(namespace, key) {\r\n    return validatePath(namespace, key).then(function(result) {\r\n        return crossfetch(`${BASE_API_PATH}/hit/${result.path}`).then(finalize);\r\n    });\r\n};\r\n\r\nmodule.exports.info = function(namespace, key) {\r\n    return validatePath(namespace, key).then(function(result) {\r\n        return crossfetch(`${BASE_API_PATH}/info/${result.path}`).then(finalize);\r\n    });\r\n};\r\n\r\nmodule.exports.create = function(options) {\r\n    var params = queryParams(options);\r\n    return crossfetch(`${BASE_API_PATH}/create${params.length > 0 ? '?' + params : ''}`).then(finalize);\r\n};\r\n\r\nmodule.exports.stats = function() {\r\n    return crossfetch(`${BASE_API_PATH}/stats`).then(finalize);\r\n};\r\n\r\nmodule.exports.visits = function(page) {\r\n    return this.hit(':HOST:', page ? page : ':PATHNAME:');\r\n};\r\n\r\nmodule.exports.event = function(name) {\r\n    return this.hit(':HOST:', name);\r\n};"]},"metadata":{},"sourceType":"script"}